# 빅데이터분석기사 작업형 3유형 - 상관분석 문제 생성 프롬프트 (개선판)

## 당신의 역할
당신은 빅데이터분석기사 실기시험 출제위원입니다. 상관분석(Correlation Analysis)에 관한 작업형 3유형 예상문제를 생성해야 합니다.

---

## 🚨🚨🚨 최종 출력 필수 포함 사항 (절대 생략 금지!) 🚨🚨🚨

**생성하는 문제는 반드시 다음 구조를 모두 포함해야 합니다:**

```markdown
# 제목

## 시나리오
[2-3문장]

## 데이터 생성 코드
[완전한 리터럴 데이터]

## ❓ 질문

**1)** [구체적인 질문 - 반드시 1)로 시작]
- 출력 형식: [소수점 자릿수 등]

**2)** [구체적인 질문 - 반드시 2)로 시작]
- 출력 형식: [명시]

**3)** [구체적인 질문 - 선택사항]
- 출력 형식: [명시]

## 힌트
[라이브러리, 함수, 주의사항]

## 정답 코드
[완전한 Python 코드]
```

**❌ 절대 하지 말 것:**
- 시나리오만 쓰고 질문을 생략
- 줄글 형태로 "~을 분석하시오" 식의 모호한 지시
- 1), 2), 3) 번호 없이 질문 나열

---

## 🔥 절대 잊지 말아야 할 핵심 규칙 (절댓값 함정 10회 반복 강조!)

### ⚠️ 규칙 1: "가장 강한" = 절댓값 최대! (1회)

```python
# 질문: "가장 강한 상관관계를 가진 변수는?"

# 상황: 성적과의 상관계수
# 공부시간: 0.85 (강한 양의 상관)
# 수면시간: -0.92 (매우 강한 음의 상관!)  ← 정답!
# 게임시간: -0.45 (중간 음의 상관)

# ❌ 잘못된 코드 (절댓값 무시!)
strongest = corr_matrix['성적'].drop('성적').idxmax()
# → '공부시간' 선택 (0.85) - 틀림!
# → -0.92를 무시함!

# ✅ 올바른 코드 (절댓값 고려!)
strongest = corr_matrix['성적'].abs().drop('성적').idxmax()
# → '수면시간' 선택 (|-0.92| = 0.92) - 정답!
```

**핵심: "가장 강한" = 절댓값이 가장 크다는 의미입니다!** (2회)

### ⚠️ 규칙 2: abs() 함수 필수! (3회)

```python
# ❌ 틀린 코드 (절댓값 없음)
최강 = df.corr()['성적'].drop('성적').max()  # 양수 중 최댓값만
최강_변수 = df.corr()['성적'].drop('성적').idxmax()

# ✅ 올바른 코드 (절댓값 포함!)
최강 = df.corr()['성적'].abs().drop('성적').max()  # 절댓값 기준 최댓값
최강_변수 = df.corr()['성적'].abs().drop('성적').idxmax()

# 🔥 .abs() 꼭 넣으세요! (4회)
```

### ⚠️ 규칙 3: 양의/음의/절댓값 구분! (5회)

```python
# 문제 유형별 정답 코드:

# 1) "가장 강한 양의 상관관계" → 양수 중 최댓값
최대_양 = corr_matrix['성적'].drop('성적').max()
최대_양_변수 = corr_matrix['성적'].drop('성적').idxmax()

# 2) "가장 강한 음의 상관관계" → 음수 중 최솟값 (절댓값 최대)
최대_음 = corr_matrix['성적'].drop('성적').min()
최대_음_변수 = corr_matrix['성적'].drop('성적').idxmin()

# 3) "가장 강한 상관관계" (양/음 구분 없이) → 절댓값 최댓값
최강 = corr_matrix['성적'].abs().drop('성적').max()
최강_변수 = corr_matrix['성적'].abs().drop('성적').idxmax()  # 🔥 abs() 필수! (6회)
```

### 🚨 규칙 4: 명확한 질문 구조 (가장 중요!)
**반드시 "❓ 질문" 섹션에 번호가 매겨진 구체적인 질문을 포함해야 합니다!**

```markdown
## ❓ 질문

**1)** 모든 변수 간의 피어슨 상관계수 행렬을 구하고, [종속변수]와 가장 강한 상관관계를 가진 변수명을 출력하시오.
- 힌트: "가장 강한" = 절댓값이 가장 큰 상관계수
- 출력 형식: 변수명 (예: "공부시간")

**2)** [종속변수]와 [변수1] 간의 피어슨 상관계수를 소수점 넷째 자리에서 반올림하여 출력하시오.
- 출력 형식: 소수점 넷째 자리 반올림 (예: 0.8542)

**3)** [종속변수]와 [변수2] 간의 상관관계가 유의수준 0.05에서 통계적으로 유의한지 판단하시오.
- 출력 형식: "유의하다" 또는 "유의하지 않다"
```

**절대 금지:**
- ❌ 시나리오만 제공하고 구체적인 질문이 없는 경우
- ❌ "분석하시오", "검정하시오" 등 모호한 지시
- ❌ 출력 형식을 명시하지 않는 경우

**반드시 포함:**
- ✅ 각 질문에 **1)**, **2)**, **3)** 번호 매기기
- ✅ 구체적인 작업 지시
- ✅ 정확한 출력 형식
- ✅ 2-3개의 구체적인 질문

---

## 중요: 반드시 지켜야 할 데이터 생성 규칙

### 1. 데이터 크기 (매우 중요!)
- ✅ **30-40행** 생성 (이전: 10-15행 → 개선: 30-40행)
- 이유 1: 상관계수의 신뢰도 확보 (n이 클수록 신뢰도↑)
- 이유 2: 정규성 검정 안정성
- 이유 3: 이상치 영향 감소

### 2. 데이터 구조
- **연속형 변수** 3개 이상 필수
- 상관관계가 명확히 드러나도록 설계
- pandas DataFrame 형식
- 변수명은 **한국어** 사용

### 3. 데이터 생성 예시 (35행)
```python
import pandas as pd

# ✅ 완전히 생성된 리터럴 데이터 제공 (np.random 사용 금지!)
df = pd.DataFrame({
    '학생': [f'S{i:02d}' for i in range(1, 36)],
    '공부시간': [2.3, 4.1, 1.8, 3.5, 2.9, 4.7, 3.2, 1.5, 4.3, 2.6,
                 3.8, 1.9, 4.5, 2.1, 3.6, 4.2, 2.8, 1.7, 3.9, 2.4,
                 4.0, 3.3, 1.6, 4.4, 2.7, 3.1, 4.6, 2.0, 3.7, 1.4,
                 4.8, 2.5, 3.4, 1.3, 3.0],  # 35개 완전한 값
    '게임시간': [3.5, 1.8, 4.3, 2.4, 3.0, 1.2, 2.7, 4.6, 1.6, 3.3,
                 2.1, 4.2, 1.4, 3.8, 2.3, 1.7, 3.1, 4.4, 2.0, 3.5,
                 1.9, 2.6, 4.5, 1.5, 3.2, 2.8, 1.3, 4.0, 2.2, 4.7,
                 1.1, 3.4, 2.5, 4.8, 2.9],  # 35개 완전한 값
    '성적': [78.5, 93.2, 74.8, 88.1, 83.6, 97.8, 85.9, 71.5, 94.7, 80.3,
             90.8, 75.2, 96.1, 77.0, 89.3, 94.0, 82.5, 73.6, 91.5, 79.1,
             92.3, 86.4, 72.8, 95.5, 81.8, 84.7, 97.2, 76.3, 90.0, 70.9,
             98.5, 80.0, 87.6, 69.8, 84.1]  # 35개 완전한 값
})
```

---

## 상관분석 완벽 가이드

### 기본 개념

**언제 사용하는가?**
- **두 연속형 변수** 간의 선형 관계를 측정할 때
- 예: 공부시간과 성적의 관계
- 예: 광고비와 매출의 관계

**상관계수 (r) 범위와 해석:**
```
r = +1: 완벽한 양의 상관 (한 변수↑ → 다른 변수도↑)
r = 0: 상관 없음
r = -1: 완벽한 음의 상관 (한 변수↑ → 다른 변수↓)

|r| ≥ 0.7: 강한 상관관계
0.4 ≤ |r| < 0.7: 뚜렷한 상관관계
0.2 ≤ |r| < 0.4: 약한 상관관계
|r| < 0.2: 상관관계 거의 없음
```

---

## 🎯 힌트 섹션 (대폭 강화!)

### 1️⃣ 필수 라이브러리
```python
import pandas as pd
import numpy as np
from scipy.stats import pearsonr, spearmanr, kendalltau, shapiro
import matplotlib.pyplot as plt  # 산점도 시각화 (선택)
```

### 2️⃣ 주요 함수 사용법 (코드 예시 포함)

#### A. 전체 상관계수 행렬 (pandas 사용 - 간단!)
```python
# 방법 1: 전체 변수 상관계수 행렬
corr_matrix = df.corr(method='pearson')  # 또는 'spearman', 'kendall'
print(corr_matrix)

# 방법 2: 특정 변수만 선택
변수들 = ['공부시간', '수면시간', '게임시간', '성적']
corr_matrix = df[변수들].corr()
print(corr_matrix)

# 방법 3: 특정 변수와 다른 모든 변수의 상관계수
성적_상관 = df.corr()['성적']
print(성적_상관)
```

#### B. 특정 변수 쌍 상관계수 (p-value 포함)
```python
from scipy.stats import pearsonr

# Pearson 상관분석 (p-value 포함)
corr, pvalue = pearsonr(df['공부시간'], df['성적'])
print(f"상관계수: {corr:.4f}")
print(f"p-value: {pvalue:.4f}")

# 유의성 판단
if pvalue < 0.05:
    print("유의한 상관관계가 있다")
else:
    print("유의한 상관관계가 없다")
```

#### C. 가장 강한 상관관계 찾기 (🔥 절댓값! 7회)
```python
# 성적과 다른 변수들의 상관계수
성적_상관 = df.corr()['성적']

# 🔥 절댓값 기준으로 최댓값! (8회)
가장_강한_변수 = 성적_상관.abs().drop('성적').idxmax()
print(f"성적과 가장 강한 상관관계: {가장_강한_변수}")

# 해당 변수와의 실제 상관계수 (음수일 수 있음!)
최강_상관계수 = 성적_상관[가장_강한_변수]
print(f"상관계수: {최강_상관계수:.4f}")

# ❌ 틀린 방법
# 가장_강한_변수 = 성적_상관.drop('성적').idxmax()  # abs() 없음!
```

#### D. 양의/음의 상관관계 구분
```python
성적_상관 = df.corr()['성적'].drop('성적')

# 가장 강한 양의 상관관계 (양수 중 최댓값)
최대_양_변수 = 성적_상관.idxmax()
최대_양_값 = 성적_상관.max()

# 가장 강한 음의 상관관계 (음수 중 최솟값)
최대_음_변수 = 성적_상관.idxmin()
최대_음_값 = 성적_상관.min()

# 가장 강한 상관관계 (절댓값 기준) - 🔥 9회
최강_변수 = 성적_상관.abs().idxmax()
최강_값 = 성적_상관[최강_변수]
```

#### E. 정규성 검정 (Pearson vs Spearman 선택)
```python
from scipy.stats import shapiro, pearsonr, spearmanr

# 정규성 검정
_, p_공부 = shapiro(df['공부시간'])
_, p_성적 = shapiro(df['성적'])

print(f"공부시간 정규성 p-value: {p_공부:.4f}")
print(f"성적 정규성 p-value: {p_성적:.4f}")

# 적절한 상관분석 방법 선택
if p_공부 > 0.05 and p_성적 > 0.05:
    # 정규성 만족 - Pearson 사용
    corr, pvalue = pearsonr(df['공부시간'], df['성적'])
    print("(Pearson 상관분석 사용)")
else:
    # 정규성 불만족 - Spearman 사용
    corr, pvalue = spearmanr(df['공부시간'], df['성적'])
    print("(정규성 불만족으로 Spearman 상관분석 사용)")

print(f"상관계수: {corr:.4f}")
print(f"p-value: {pvalue:.4f}")
```

#### F. 전체 변수 쌍 중 최대 상관 찾기
```python
# 상관계수 행렬에서 대각선(자기 자신) 제외하고 최댓값 찾기
corr_matrix = df.corr()

# 절댓값 기준 상관계수 행렬
corr_abs = corr_matrix.abs().values
np.fill_diagonal(corr_abs, 0)  # 대각선을 0으로 (자기 자신 제외)

# 최댓값 위치 찾기
max_idx = np.unravel_index(corr_abs.argmax(), corr_abs.shape)
변수1 = corr_matrix.columns[max_idx[0]]
변수2 = corr_matrix.columns[max_idx[1]]
최대_상관계수 = corr_matrix.loc[변수1, 변수2]

print(f"전체 최강 상관 쌍: {변수1}-{변수2}")
print(f"상관계수: {최대_상관계수:.4f}")
```

#### G. 산점도 시각화 (선택)
```python
import matplotlib.pyplot as plt

plt.figure(figsize=(8, 6))
plt.scatter(df['공부시간'], df['성적'])
plt.xlabel('공부시간 (시간/일)')
plt.ylabel('성적 (점)')
plt.title('공부시간과 성적의 관계')
plt.grid(True)
plt.show()
```

### 3️⃣ 의사결정 트리 (문제 풀이 순서)

```
시작
 │
 ├─ 1. 데이터 확인
 │   ├─ 변수가 연속형인가? → 범주형이면 카이제곱 검정
 │   ├─ 변수가 2개 이상인가? → OK
 │   └─ 데이터가 30개 이상인가? → 권장
 │
 ├─ 2. 상관분석 방법 선택
 │   ├─ 정규성 검정 필요? (문제에서 요구 시)
 │   │   ├─ 두 변수 모두 정규성 만족? → Pearson
 │   │   └─ 정규성 불만족? → Spearman 또는 Kendall
 │   └─ 정규성 검정 없음? → Pearson 사용 (기본)
 │
 ├─ 3. 상관계수 계산
 │   ├─ 전체 행렬: df.corr()
 │   ├─ 특정 쌍: pearsonr(x, y) 또는 spearmanr(x, y)
 │   └─ p-value 필요? → scipy.stats 함수 사용
 │
 ├─ 4. "가장 강한" 상관관계 찾기
 │   ├─ 🔥 절댓값 기준! (10회) ← 매우 중요!
 │   ├─ corr_matrix['변수'].abs().drop('변수').idxmax()
 │   └─ abs() 꼭 넣기!
 │
 ├─ 5. 양의/음의 구분 (질문 유형에 따라)
 │   ├─ 양의 최댓값: idxmax() (abs 없음)
 │   ├─ 음의 최솟값: idxmin() (abs 없음)
 │   └─ 절댓값 최댓값: abs().idxmax()
 │
 └─ 6. 유의성 검정
     ├─ p-value < 0.05? → "유의하다"
     └─ p-value ≥ 0.05? → "유의하지 않다"
```

### 4️⃣ 흔한 실수와 함정

#### ❌ 실수 1: 절댓값 무시 (가장 치명적!)
```python
# 상황: 성적과의 상관계수
# 공부시간: 0.65
# 수면시간: -0.85  ← 절댓값 0.85로 가장 강함!

# ❌ 틀린 코드
strongest = df.corr()['성적'].drop('성적').idxmax()
# → '공부시간' 선택 (틀림!)

# ✅ 올바른 코드
strongest = df.corr()['성적'].abs().drop('성적').idxmax()
# → '수면시간' 선택 (정답!)
```

#### ❌ 실수 2: 자기 자신 제외 안 함
```python
# ❌ 틀린 코드
strongest = df.corr()['성적'].abs().idxmax()
# → '성적' 자신이 선택됨 (r = 1.0)

# ✅ 올바른 코드
strongest = df.corr()['성적'].abs().drop('성적').idxmax()
# → 자기 자신 제외하고 찾음
```

#### ❌ 실수 3: pandas vs scipy 혼동
```python
# 방법 1: pandas (간단, p-value 없음)
corr = df['변수1'].corr(df['변수2'])

# 방법 2: scipy (p-value 포함)
from scipy.stats import pearsonr
corr, pvalue = pearsonr(df['변수1'], df['변수2'])

# p-value 필요하면 scipy 사용!
```

#### ❌ 실수 4: 양의/음의/절댓값 혼동
```python
# "가장 강한 양의 상관" → max() (abs 없음)
최대_양 = df.corr()['성적'].drop('성적').max()

# "가장 강한 음의 상관" → min() (abs 없음)
최대_음 = df.corr()['성적'].drop('성적').min()

# "가장 강한 상관" → abs().max()
최강 = df.corr()['성적'].abs().drop('성적').max()
```

#### ❌ 실수 5: Pearson vs Spearman 선택 기준 불분명
```python
# Pearson: 정규분포 + 선형 관계
# Spearman: 정규분포 불필요 + 단조 관계 (비선형도 가능)
# Kendall: 소표본(n < 30) 또는 동점 많을 때

# 정규성 검정으로 선택
if shapiro(x)[1] > 0.05 and shapiro(y)[1] > 0.05:
    corr, p = pearsonr(x, y)  # Pearson
else:
    corr, p = spearmanr(x, y)  # Spearman
```

### 5️⃣ 체크리스트 (분석 전 확인!)

```
데이터 확인:
✅ 변수가 연속형인가?
✅ 데이터가 30개 이상인가?
✅ 결측치가 없는가?

상관분석 방법:
✅ 정규성 검정이 필요한가?
✅ Pearson vs Spearman 중 어느 것을 사용하는가?
✅ p-value가 필요한가? → scipy 함수 사용

"가장 강한" 찾기:
✅ abs()를 넣었는가? (매우 중요!)
✅ drop()으로 자기 자신을 제외했는가?
✅ 양의/음의/절댓값을 구분했는가?

결과 해석:
✅ 상관계수의 부호(+/-)를 확인했는가?
✅ 상관계수의 크기(|r|)를 해석했는가?
✅ p-value로 유의성을 판단했는가?
```

---

## 상관분석 3가지 유형

### 1. Pearson 상관분석 (모수 검정)
```python
from scipy.stats import pearsonr

corr, pvalue = pearsonr(df['변수1'], df['변수2'])

# 가정: 두 변수 모두 정규분포
# 용도: 선형 관계 측정
# 장점: 가장 널리 사용, 해석 쉬움
# 단점: 정규성 불만족 시 부정확
```

### 2. Spearman 상관분석 (비모수 검정)
```python
from scipy.stats import spearmanr

corr, pvalue = spearmanr(df['변수1'], df['변수2'])

# 가정: 정규분포 불필요 (순위 기반)
# 용도: 비선형 단조 관계 측정, 정규성 불만족 시
# 장점: 정규성 가정 불필요, 이상치 영향 적음
# 단점: 순위로 변환하므로 정보 손실
```

### 3. Kendall 상관분석 (비모수 검정)
```python
from scipy.stats import kendalltau

corr, pvalue = kendalltau(df['변수1'], df['변수2'])

# 가정: 정규분포 불필요 (순위 기반)
# 용도: 소표본(n < 30) 또는 동점 많을 때
# 장점: Spearman보다 정확 (작은 표본)
# 단점: 계산 복잡, 해석 어려움
```

---

## 문제 생성 템플릿

### 기본 문제 구조
```markdown
# 상관분석 문제: [제목]

## 시나리오
[변수 간 상관관계 분석 상황 - 구체적이고 현실적으로]

## 데이터 생성 코드
[DataFrame 코드 - 반드시 30-40행! 연속형 변수 3개 이상]

## 질문
1) (선택) 정규성 검정 (Pearson vs Spearman 선택용)
2) 상관계수 행렬 생성
3) 특정 변수 쌍 간 상관계수 출력
4) 가장 강한 상관관계를 가진 변수 찾기 (🔥 절댓값!)
5) 해당 변수와의 상관계수 값 출력
6) p-value 출력 및 유의성 검정
7) (선택) 양의/음의 상관관계 최댓값 찾기

## 힌트
[위의 "힌트 섹션" 내용 축약 포함]
- 🔥 필수 강조: 절댓값 함정 10회 이상!
- 가장 강한 = abs().idxmax()

## 정답 코드
[전체 풀이 과정 - 데이터 생성부터 모든 질문 답변까지]
```

---

## 🎯 문제 생성 체크리스트

문제를 생성하기 전에 반드시 확인하세요:

### 데이터 관련
- [ ] 데이터는 30-40행인가?
- [ ] 연속형 변수가 3개 이상인가?
- [ ] 상관관계가 명확히 드러나는가? (너무 약하면 X)
- [ ] 변수명은 한국어로 작성했는가?
- [ ] DataFrame 코드 형식으로 생성했는가?

### 힌트 섹션
- [ ] 절댓값 함정을 10회 이상 강조했는가? (매우 중요!)
- [ ] abs()를 사용하는 코드 예시를 충분히 제공했는가?
- [ ] 양의/음의/절댓값 구분을 명확히 설명했는가?
- [ ] 의사결정 트리가 포함되어 있는가?
- [ ] 흔한 실수 섹션이 포함되어 있는가?
- [ ] Pearson/Spearman/Kendall 선택 기준을 설명했는가?

### 질문 구성
- [ ] 상관계수 행렬 생성 질문이 포함되어 있는가?
- [ ] 특정 쌍 상관계수 질문이 포함되어 있는가?
- [ ] "가장 강한" 상관관계 질문이 포함되어 있는가?
- [ ] 절댓값 기준임을 명시했는가?
- [ ] p-value 및 유의성 검정 질문이 포함되어 있는가?
- [ ] 4-7개의 소문항으로 구성했는가?

### 정답 코드
- [ ] 데이터 생성 코드가 포함되어 있는가?
- [ ] abs()를 사용한 코드가 포함되어 있는가?
- [ ] drop()으로 자기 자신을 제외하는 코드가 포함되어 있는가?
- [ ] pandas와 scipy 두 방법을 모두 활용했는가?
- [ ] 모든 질문에 대한 답변 코드가 포함되어 있는가?
- [ ] 주석으로 각 단계를 명확히 설명했는가?

### 시나리오
- [ ] 구체적이고 현실적인 상황인가?
- [ ] 상관관계 분석이 자연스러운 상황인가?
- [ ] 연속형 변수들이 논리적으로 관련 있는가?

---

## 완성된 문제 예시 (35행 데이터)

```markdown
# 상관분석 문제: 학습 습관과 학업 성취도의 관계

## 시나리오
한 교육연구소에서 학생들의 학습 습관이 학업 성취도에 미치는 영향을 분석하기 위해 35명의 중학생으로부터 일일 공부시간(시간), 수면시간(시간), 스마트폰 사용시간(시간), 학업성취도(점)를 수집했습니다. 각 변수 간의 상관관계를 분석하여 학업성취도와 가장 관련이 높은 요인을 찾으려고 합니다.

## 데이터 생성 코드
```python
import pandas as pd
import numpy as np

np.random.seed(2024)

# 상관관계를 가지도록 데이터 생성
공부시간 = np.random.uniform(1.5, 5.0, 35)
수면시간 = np.random.uniform(5.0, 9.0, 35)
스마트폰시간 = np.random.uniform(1.0, 6.0, 35)

# 학업성취도: 공부시간(+), 수면시간(+), 스마트폰시간(-)와 상관
학업성취도 = (50 + 
             8 * 공부시간 + 
             3 * 수면시간 - 
             4 * 스마트폰시간 + 
             np.random.normal(0, 5, 35))

df = pd.DataFrame({
    '학생': [f'학생{i}' for i in range(1, 36)],
    '공부시간': np.round(공부시간, 1),
    '수면시간': np.round(수면시간, 1),
    '스마트폰시간': np.round(스마트폰시간, 1),
    '학업성취도': np.round(학업성취도, 1)
})

print(df)
print(f"\n총 학생 수: {len(df)}명")
```

## 질문

**1)** 공부시간, 수면시간, 스마트폰시간, 학업성취도에 대해 Shapiro-Wilk 정규성 검정을 수행하시오.
- 네 변수 모두 정규성을 만족하면 1, 하나라도 만족하지 않으면 0을 출력

**2)** 네 변수 간의 Pearson 상관계수 행렬을 구하시오.
- 1)의 결과가 0이면 Spearman 상관계수 행렬 사용

**3)** '공부시간'과 '학업성취도' 간의 상관계수를 소수점 넷째 자리에서 반올림하여 출력하시오.

**4)** 3)에서 구한 상관계수의 p-value를 소수점 넷째 자리에서 반올림하여 출력하시오.

**5)** '학업성취도'와 가장 강한 상관관계(절댓값 기준)를 가진 변수의 이름을 출력하시오.
- 🔥 주의: 절댓값 기준!
- 출력 형식: 변수명 (예: "공부시간")

**6)** 5)에서 찾은 변수와 학업성취도 간의 상관계수를 소수점 넷째 자리에서 반올림하여 출력하시오.
- 주의: 음수일 수도 있음

**7)** 유의수준 0.05에서 '스마트폰시간'과 '학업성취도' 간의 상관관계가 통계적으로 유의한지 판단하시오.
- 출력 형식: "유의하다" 또는 "유의하지 않다"

**8)** 모든 변수 쌍 중에서 상관계수의 절댓값이 가장 큰 쌍을 찾으시오.
- 출력 형식: "변수1-변수2" (예: "공부시간-학업성취도")
- 자기 자신과의 상관계수(1.0) 제외

## 힌트

### 필수 라이브러리
```python
from scipy.stats import pearsonr, spearmanr, shapiro
```

### 정규성 검정
```python
_, p_공부 = shapiro(df['공부시간'])
_, p_수면 = shapiro(df['수면시간'])
_, p_스마트폰 = shapiro(df['스마트폰시간'])
_, p_학업 = shapiro(df['학업성취도'])

정규성_만족 = all([p > 0.05 for p in [p_공부, p_수면, p_스마트폰, p_학업]])
```

### 상관계수 행렬
```python
if 정규성_만족:
    corr_matrix = df.corr(method='pearson')
else:
    corr_matrix = df.corr(method='spearman')
```

### 🔥 가장 강한 상관관계 (절댓값!)
```python
# 학업성취도와 다른 변수들의 상관계수
학업_상관 = corr_matrix['학업성취도'].drop('학업성취도')

# 🔥 절댓값 기준으로 최댓값! (매우 중요!)
가장_강한_변수 = 학업_상관.abs().idxmax()

# 해당 변수와의 실제 상관계수 (음수일 수 있음)
최강_상관계수 = 학업_상관[가장_강한_변수]
```

### p-value 계산
```python
corr, pvalue = pearsonr(df['변수1'], df['변수2'])

if pvalue < 0.05:
    print("유의하다")
else:
    print("유의하지 않다")
```

### 전체 최대 상관 쌍
```python
corr_matrix = df.corr()
corr_abs = corr_matrix.abs().values
np.fill_diagonal(corr_abs, 0)  # 자기 자신 제외

max_idx = np.unravel_index(corr_abs.argmax(), corr_abs.shape)
변수1 = corr_matrix.columns[max_idx[0]]
변수2 = corr_matrix.columns[max_idx[1]]
```

### 흔한 실수
- ❌ abs() 없이 idxmax() 사용 → 절댓값 무시!
- ✅ abs().idxmax() 사용 → 절댓값 고려!
- ❌ drop() 없이 찾기 → 자기 자신 선택됨!
- ✅ drop('변수').idxmax() → 자기 자신 제외!

## 정답 코드
```python
import pandas as pd
import numpy as np
from scipy.stats import pearsonr, spearmanr, shapiro

# 데이터 생성
np.random.seed(2024)

공부시간 = np.random.uniform(1.5, 5.0, 35)
수면시간 = np.random.uniform(5.0, 9.0, 35)
스마트폰시간 = np.random.uniform(1.0, 6.0, 35)

학업성취도 = (50 + 
             8 * 공부시간 + 
             3 * 수면시간 - 
             4 * 스마트폰시간 + 
             np.random.normal(0, 5, 35))

df = pd.DataFrame({
    '학생': [f'학생{i}' for i in range(1, 36)],
    '공부시간': np.round(공부시간, 1),
    '수면시간': np.round(수면시간, 1),
    '스마트폰시간': np.round(스마트폰시간, 1),
    '학업성취도': np.round(학업성취도, 1)
})

# 1) 정규성 검정
_, p_공부 = shapiro(df['공부시간'])
_, p_수면 = shapiro(df['수면시간'])
_, p_스마트폰 = shapiro(df['스마트폰시간'])
_, p_학업 = shapiro(df['학업성취도'])

정규성_만족 = 1 if all([p > 0.05 for p in [p_공부, p_수면, p_스마트폰, p_학업]]) else 0
print(f"1) 정규성 만족 여부: {정규성_만족}")
print(f"   공부시간 p={p_공부:.4f}, 수면시간 p={p_수면:.4f}")
print(f"   스마트폰시간 p={p_스마트폰:.4f}, 학업성취도 p={p_학업:.4f}\n")

# 2) 상관계수 행렬
변수들 = ['공부시간', '수면시간', '스마트폰시간', '학업성취도']

if 정규성_만족 == 1:
    corr_matrix = df[변수들].corr(method='pearson')
    print("2) Pearson 상관계수 행렬:")
else:
    corr_matrix = df[변수들].corr(method='spearman')
    print("2) Spearman 상관계수 행렬:")

print(corr_matrix)
print()

# 3) 공부시간과 학업성취도 간 상관계수
corr_공부_학업 = df['공부시간'].corr(df['학업성취도'])
print(f"3) 공부시간-학업성취도 상관계수: {round(corr_공부_학업, 4)}")

# 4) p-value 계산
if 정규성_만족 == 1:
    _, p_value = pearsonr(df['공부시간'], df['학업성취도'])
else:
    _, p_value = spearmanr(df['공부시간'], df['학업성취도'])

print(f"4) p-value: {round(p_value, 4)}\n")

# 5-6) 학업성취도와 가장 강한 상관관계를 가진 변수
학업_상관 = corr_matrix['학업성취도'].drop('학업성취도')

# 🔥 절댓값 기준으로 최댓값! (매우 중요!)
가장_강한_변수 = 학업_상관.abs().idxmax()
print(f"5) 학업성취도와 가장 강한 상관관계 변수: {가장_강한_변수}")

# 해당 변수와의 실제 상관계수 (음수일 수 있음)
최강_상관계수 = 학업_상관[가장_강한_변수]
print(f"6) {가장_강한_변수}-학업성취도 상관계수: {round(최강_상관계수, 4)}\n")

# 7) 스마트폰시간과 학업성취도 간 유의성 검정
if 정규성_만족 == 1:
    _, p_스마트폰_학업 = pearsonr(df['스마트폰시간'], df['학업성취도'])
else:
    _, p_스마트폰_학업 = spearmanr(df['스마트폰시간'], df['학업성취도'])

if p_스마트폰_학업 < 0.05:
    print("7) 유의하다\n")
else:
    print("7) 유의하지 않다\n")

# 8) 전체에서 가장 강한 쌍
corr_abs = corr_matrix.abs().values
np.fill_diagonal(corr_abs, 0)  # 자기 자신 제외

max_idx = np.unravel_index(corr_abs.argmax(), corr_abs.shape)
변수1 = corr_matrix.columns[max_idx[0]]
변수2 = corr_matrix.columns[max_idx[1]]

print(f"8) 전체 최강 상관 쌍: {변수1}-{변수2}")
print(f"   상관계수: {round(corr_matrix.loc[변수1, 변수2], 4)}")

# 추가: 산점도 시각화 (선택)
import matplotlib.pyplot as plt

plt.figure(figsize=(10, 8))
for i, var in enumerate(['공부시간', '수면시간', '스마트폰시간'], 1):
    plt.subplot(2, 2, i)
    plt.scatter(df[var], df['학업성취도'], alpha=0.6)
    plt.xlabel(var)
    plt.ylabel('학업성취도')
    plt.title(f'{var} vs 학업성취도')
    plt.grid(True, alpha=0.3)

plt.tight_layout()
plt.show()
```
```

---

## 출력 형식

생성된 문제는 반드시 다음 구조를 따라야 합니다:

```
# 상관분석 문제: [제목]

## 시나리오
[변수 간 상관관계 분석 상황 - 구체적이고 현실적으로]

## 데이터 생성 코드
[DataFrame 코드 - 반드시 30-40행! 연속형 변수 3개 이상]

## 질문
1) (선택) 정규성 검정
2) 상관계수 행렬
3) 특정 쌍 상관계수
4) p-value
5) 가장 강한 상관관계 변수 (🔥 절댓값 기준!)
6) 해당 상관계수 값
7) 유의성 검정
8) (선택) 전체 최대 상관 쌍

## 힌트
[필수 라이브러리, 함수 사용법, 흔한 실수]
- 🔥 절댓값 함정 10회 이상 강조!
- abs().idxmax() 사용법 강조!

## 정답 코드
[전체 풀이 코드 - 절댓값 처리 명확히]
```

---

## 마지막 당부사항

1. **데이터는 반드시 30-40행으로 생성하세요**
2. **절댓값 함정을 10회 이상 강조하세요** (매우 중요!)
3. **abs()를 사용하는 코드를 충분히 제공하세요**
4. **양의/음의/절댓값 구분을 명확히 하세요**
5. **힌트 섹션을 대폭 강화하세요** (함수 사용법, 의사결정 트리, 흔한 실수)
6. **정규성 검정으로 Pearson/Spearman 선택하는 로직을 포함하면 더 좋습니다**

이제 위 지침에 따라 상관분석 문제를 생성해주세요!
